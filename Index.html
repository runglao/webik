<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Система голосования</title>
</head>
<body>
    
    <h1>Подключение MetaMask и вывод баланса</h1>

    <!-- Кнопка для подключения MetaMask -->

    <button onclick="connectMetaMask()">Подключить MetaMask</button>
    <p id="walletAddress">Адрес кошелька: не подключен</p>
    <p id="walletBalance">Баланс: - ETH</p>


    <script> 
    
    let web3;
let userAccount;

// Подключение MetaMask и инициализация Web3
async function connectMetaMask() {
    if (typeof window.ethereum !== 'undefined') {
        try {
            // Запрашиваем доступ к аккаунтам MetaMask
            await window.ethereum.request({ method: "eth_requestAccounts" });

            // Инициализируем Web3
            web3 = new Web3(window.ethereum);

            // Получаем аккаунт пользователя
            const accounts = await web3.eth.getAccounts();
            
            if (accounts.length === 0) {
                alert("Не удалось получить аккаунты. Проверьте настройки MetaMask.");
                return;
            }

            userAccount = accounts[0];
            document.getElementById("walletAddress").innerText = `Адрес кошелька: ${userAccount}`;

            // Получаем и отображаем баланс
            const balance = await web3.eth.getBalance(userAccount);
            const balanceInEth = web3.utils.fromWei(balance, "ether");
            document.getElementById("walletBalance").innerText = `Баланс: ${balanceInEth} ETH`;

            alert("MetaMask успешно подключен!");
        } catch (error) {
            // Обрабатываем возможные ошибки
            console.error("Ошибка при подключении MetaMask:", error);

            if (error.code === 4001) {
                alert("Отклонено пользователем. Пожалуйста, разрешите доступ.");
            } else if (error.message.includes("eth_requestAccounts")) {
                alert("Ошибка при запросе аккаунтов. Убедитесь, что MetaMask открыт.");
            } else {
                alert("Произошла ошибка при подключении MetaMask. Подробности в консоли.");
            }
        }
    } else {
        alert("MetaMask не установлен. Пожалуйста, установите MetaMask.");
    }
}


    </script>

</body>
</html>
